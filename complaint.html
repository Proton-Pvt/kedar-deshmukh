<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Food Quality Issue</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  body{
    font-family:Inter, sans-serif;
    background:linear-gradient(135deg,#111827,#1f2933);
    min-height:100vh;
    margin:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#111;
  }

  .card{
    background:#fff;
    width:100%;
    max-width:420px;
    padding:26px;
    border-radius:14px;
    box-shadow:0 20px 50px rgba(0,0,0,.35);
  }

  h2{
    margin-top:0;
    text-align:center;
    font-weight:700;
    color:#ff7a1a;
  }

  p.sub{
    text-align:center;
    font-size:14px;
    color:#555;
    margin-bottom:20px;
  }

  label{
    font-size:13px;
    font-weight:600;
    color:#444;
    display:block;
    margin-bottom:6px;
  }

  input, textarea{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:14px;
    margin-bottom:14px;
  }

  textarea{
    resize:none;
    min-height:90px;
  }

  input[type="file"]{
    border:none;
    padding:6px 0;
  }

  #preview{
    width:100%;
    border-radius:10px;
    margin-top:10px;
    display:none;
    border:1px solid #eee;
  }

  button{
    width:100%;
    padding:13px;
    border:none;
    border-radius:10px;
    background:#ff7a1a;
    color:#fff;
    font-weight:700;
    font-size:15px;
    cursor:pointer;
    transition:.2s;
  }

  button:hover{
    background:#e66b13;
    transform:translateY(-1px);
  }

  #msg{
    margin-top:14px;
    text-align:center;
    font-size:14px;
    font-weight:600;
    color:#16a34a;
  }

  .footer-note{
    margin-top:18px;
    text-align:center;
    font-size:12px;
    color:#777;
  }
</style>
</head>

<body>

<div class="card">
        <h4>Report a Food Issue</h4>
  <p class="sub">Help us improve by reporting food quality problems</p>

  <label>Phone Number</label>
  <input id="phone" placeholder="Enter your phone number">

  <label>Describe the issue</label>
  <textarea id="desc" placeholder="Explain the issue in detail..."></textarea>

  <label>Upload Photo (optional)</label>
  <input id="photo" type="file" accept="image/*">
  <img id="preview">

  <button id="submit">Submit Issue </button>
  <hr style="margin:30px 0">

<h3>Check Complaint Status</h3>

<input id="checkPhone" placeholder="Enter your phone number">
<button id="checkStatus">Check Status</button>

<div id="statusResult"></div>


  <div id="msg"></div>

  <div class="footer-note">
    Our team will review and update you shortly
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCrj_dMhYpdRZeKIYTAckYdqGE4f0FBz8w",
  authDomain: "restaurant-database-1ca9d.firebaseapp.com",
  projectId: "restaurant-database-1ca9d",
  storageBucket: "restaurant-database-1ca9d.firebasestorage.app",
  messagingSenderId: "772678372956",
  appId: "1:772678372956:web:1e517b1f963d58f3c1a099"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let base64Image = null;
 
import {
  query,
  where,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

document.getElementById("checkStatus").addEventListener("click", async () => {

  const phone = document.getElementById("checkPhone").value.trim();
  const result = document.getElementById("statusResult");

  if(!phone){
    alert("Enter phone number");
    return;
  }

  const q = query(
    collection(db, "complaints"),
    where("phone", "==", phone)
  );

  const snap = await getDocs(q);

  if(snap.empty){
    result.innerHTML = "<p>No complaint found.</p>";
    return;
  }

  let html = "";
  snap.forEach(doc => {
    const c = doc.data();
    html += `
      <div style="padding:10px;margin-top:10px;border-radius:8px;background:#f4f4f4">
        <b>Status:</b> ${c.status}<br>
        <small>${c.description}</small>
      </div>
    `;
  });

  result.innerHTML = html;
});
 

// Image preview + base64
document.getElementById("photo").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = ev=>{
    base64Image = ev.target.result;
    document.getElementById("preview").src = base64Image;
    document.getElementById("preview").style.display = "block";
  };
  reader.readAsDataURL(file);
});

// Submit complaint
document.getElementById("submit").addEventListener("click", async ()=>{
  const phone = document.getElementById("phone").value.trim();
  const desc  = document.getElementById("desc").value.trim();
  const msg   = document.getElementById("msg");

  if(!phone || !desc){
    alert("Phone and description are required");
    return;
  }

  try{
    await addDoc(collection(db,"complaints"),{
      phone,
      description:desc,
      imageBase64:base64Image,
      status:"Open",
      createdAt:serverTimestamp()
    });

    msg.textContent = "Issue submitted successfully âœ”";
    document.getElementById("phone").value="";
    document.getElementById("desc").value="";
    document.getElementById("photo").value="";
    document.getElementById("preview").style.display="none";
    base64Image=null;

  }catch(err){
    alert("Error submitting issue");
    console.error(err);
  }
});
</script>

</body>
</html>
